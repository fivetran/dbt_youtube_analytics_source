version: 2

sources:
  - name: youtube_analytics
    schema: "{{ var('youtube_analytics_schema', 'youtube_analytics') }}"
    database: "{% if target.type != '!!!!!!! REPLACE 'spark' WITH 'spark','databricks' OR EQUIV !!!!!!!'%}{{ var('youtube_analytics_database', target.database) }}{% endif %}"
    loader: Fivetran
    loaded_at_field: _fivetran_synced
    tables:
      - name: channel_basic
        identifier: "{{ var('youtube__channel_basic_table', 'channel_basic_a_2') }}"
        description: Provides user activity statistics related to a channel and its videos
        columns:
          - name: _fivetran_id
            description: The unique ID of the record generated by Fivetran
          - name: date
            description: The date the video was viewed
          - name: _fivetran_synced
            description: Timestamp of when the record was synced by Fivetran
          - name: average_view_duration_percentage
            description: Average view duration calculated as a percentage
          - name: average_view_duration_seconds
            description: Average view duration calculated in seconds
          - name: channel_id
            description: Unique identifier of the video channel
          - name: comments
            description: Number of comments the posted towards the video
          - name: dislikes
            description: Number of dislikes the video received
          - name: likes
            description: Number of likes the video received
          - name: shares
            description: Number of times the video was shared
          - name: subscribers_gained
            description: Number of subscribers gained
          - name: subscribers_lost
            description: Number of subscribers lost
          - name: video_id
            description: Unique ID of the video
          - name: views
            description: Number of views the video received
          - name: watch_time_minutes
            description: Total watch time the video received in minutes
  
      - name: channel_demographics
        identifier: "{{ var('youtube__channel_demographics_table', 'channel_demographics_a_1') }}"
        description: Aggregates viewing statistics based on viewers' age group and gender.
        columns:
          - name: _fivetran_id
            description: The unique ID of the record generated by Fivetran
          - name: _fivetran_synced
            description: Timestamp of when the record was synced by Fivetran
          - name: age_group
            description: The age group the individual. Ranges follow the format of 'AGE_[min age]_[max age]'
          - name: channel_id
            description: Reference of channel which the video belongs
          - name: country_code
            description: Country code where the individual who watched the video is located
          - name: date
            description: Date the video was watched
          - name: gender
            description: Gender of the user who watched the video. Either 'MALE', 'FEMALE', or 'GENDER_OTHER'
          - name: live_or_on_demand
            description: Indicates if the video was watched live or on demand. Either 'live' or 'on_demand'
          - name: subscribed_status
            description: Indicates if the viewer was subscribed when watching the video. Either 'not_subscribed' or 'subscribed'
          - name: video_id
            description: Unique reference ID of the video
          - name: views_percentage
            description: Total percent of views the user makes up for the video

  - name: youtube_metadata
    schema: "{{ var('youtube_metadata_schema', 'youtube_analytics_metadata') }}"
    database: "{% if target.type != '!!!!!!! REPLACE 'spark' WITH 'spark','databricks' OR EQUIV !!!!!!!'%}{{ var('youtube_analytics_database', target.database) }}{% endif %}"
    loader: Fivetran
    loaded_at_field: _fivetran_synced
    tables:
      - name: videos
        description: >
          Table containing individual video metadata. This table IS NOT synced by Fivetran. However, you may easily configure a Fivetran Cloud Function
          as shown in our [blog post](tbd) to sync your Youtube video metadata to a table in your warehouse and have this dbt package generate the video
          metadata table in this same schema which can then be used in downstream models.
        columns:
          - name: id
            description: The unique ID of the video
          - name: title
            description: The title of the video
          - name: description
            description: A description of the video
          - name: channel_title
            description: The name of the channel which the video belongs
          - name: published_at
            description: Timestamp of when the video was published to Youtube
          - name: thumbnails
            description: JSON which contains the default, medium, and high quality thumbnail urls
          - name: _fivetran_batch
            description: The batch which the record was synced
          - name: _fivetran_index
            description: The video sync record index
          - name: _fivetran_synced
            description: Timestamp of when the record was synced by Fivetran